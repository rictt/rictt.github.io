<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>webpack整理 | 狗子的博客</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/logo.png">
    <meta name="description" content="记录生活，记录bug!">
    
    <link rel="preload" href="/assets/css/0.styles.2d7509d5.css" as="style"><link rel="preload" href="/assets/js/app.bb8cb600.js" as="script"><link rel="preload" href="/assets/js/11.a3791431.js" as="script"><link rel="preload" href="/assets/js/43.fafef18f.js" as="script"><link rel="prefetch" href="/assets/js/1.22b784aa.js"><link rel="prefetch" href="/assets/js/12.6261f5b4.js"><link rel="prefetch" href="/assets/js/13.86a047ff.js"><link rel="prefetch" href="/assets/js/14.7953b57d.js"><link rel="prefetch" href="/assets/js/15.1ecae33c.js"><link rel="prefetch" href="/assets/js/16.c06b96a9.js"><link rel="prefetch" href="/assets/js/17.aea8c476.js"><link rel="prefetch" href="/assets/js/18.2ddb3342.js"><link rel="prefetch" href="/assets/js/19.46105c6c.js"><link rel="prefetch" href="/assets/js/2.7524170b.js"><link rel="prefetch" href="/assets/js/20.21d391f0.js"><link rel="prefetch" href="/assets/js/21.01f8e774.js"><link rel="prefetch" href="/assets/js/22.d82de8e2.js"><link rel="prefetch" href="/assets/js/23.c902bd4c.js"><link rel="prefetch" href="/assets/js/24.cb4ed996.js"><link rel="prefetch" href="/assets/js/25.06f23009.js"><link rel="prefetch" href="/assets/js/26.6a416950.js"><link rel="prefetch" href="/assets/js/27.f239f8b2.js"><link rel="prefetch" href="/assets/js/28.e6595db8.js"><link rel="prefetch" href="/assets/js/29.2499de18.js"><link rel="prefetch" href="/assets/js/3.c13987f3.js"><link rel="prefetch" href="/assets/js/30.ec2771a3.js"><link rel="prefetch" href="/assets/js/31.cab925d7.js"><link rel="prefetch" href="/assets/js/32.aaba9d6b.js"><link rel="prefetch" href="/assets/js/33.4dede3ae.js"><link rel="prefetch" href="/assets/js/34.e108cd73.js"><link rel="prefetch" href="/assets/js/35.31dd9db1.js"><link rel="prefetch" href="/assets/js/36.35a96604.js"><link rel="prefetch" href="/assets/js/37.ccd32209.js"><link rel="prefetch" href="/assets/js/38.767cc5f3.js"><link rel="prefetch" href="/assets/js/39.7ed8889b.js"><link rel="prefetch" href="/assets/js/4.7abd0e8e.js"><link rel="prefetch" href="/assets/js/40.d35c39ec.js"><link rel="prefetch" href="/assets/js/41.844b41da.js"><link rel="prefetch" href="/assets/js/42.f0c77d2b.js"><link rel="prefetch" href="/assets/js/44.3821eb8f.js"><link rel="prefetch" href="/assets/js/45.0585464f.js"><link rel="prefetch" href="/assets/js/46.1f77f027.js"><link rel="prefetch" href="/assets/js/47.f47808a4.js"><link rel="prefetch" href="/assets/js/48.dbaed69f.js"><link rel="prefetch" href="/assets/js/49.0859a6e0.js"><link rel="prefetch" href="/assets/js/5.dc5a5f90.js"><link rel="prefetch" href="/assets/js/50.cb3a8f5b.js"><link rel="prefetch" href="/assets/js/51.0b6551a0.js"><link rel="prefetch" href="/assets/js/52.ad422568.js"><link rel="prefetch" href="/assets/js/53.92cb68e0.js"><link rel="prefetch" href="/assets/js/54.f83681f3.js"><link rel="prefetch" href="/assets/js/55.0267d285.js"><link rel="prefetch" href="/assets/js/56.a82dbeec.js"><link rel="prefetch" href="/assets/js/57.ba4f8ea5.js"><link rel="prefetch" href="/assets/js/58.384dc386.js"><link rel="prefetch" href="/assets/js/59.04682dac.js"><link rel="prefetch" href="/assets/js/6.e5a57202.js"><link rel="prefetch" href="/assets/js/60.4f7c43ab.js"><link rel="prefetch" href="/assets/js/61.85cfacbf.js"><link rel="prefetch" href="/assets/js/62.cddefb27.js"><link rel="prefetch" href="/assets/js/63.867189ef.js"><link rel="prefetch" href="/assets/js/64.ab1ec420.js"><link rel="prefetch" href="/assets/js/65.35c96559.js"><link rel="prefetch" href="/assets/js/66.b256f951.js"><link rel="prefetch" href="/assets/js/67.ddb92cad.js"><link rel="prefetch" href="/assets/js/68.0860b2f0.js"><link rel="prefetch" href="/assets/js/69.58b713c5.js"><link rel="prefetch" href="/assets/js/7.d65eb7e3.js"><link rel="prefetch" href="/assets/js/70.001ed193.js"><link rel="prefetch" href="/assets/js/71.632935b7.js"><link rel="prefetch" href="/assets/js/72.ed6347bf.js"><link rel="prefetch" href="/assets/js/73.1ef8eae4.js"><link rel="prefetch" href="/assets/js/74.334f3694.js"><link rel="prefetch" href="/assets/js/75.b9dd2ad8.js"><link rel="prefetch" href="/assets/js/76.8bef6b4f.js"><link rel="prefetch" href="/assets/js/8.44a6ebd7.js"><link rel="prefetch" href="/assets/js/9.391e332d.js">
    <link rel="stylesheet" href="/assets/css/0.styles.2d7509d5.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.png" alt="狗子的博客" class="logo"> <span class="site-name can-hide">狗子的博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><a href="/canvas/" class="sidebar-heading clickable open"><span>canvas</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/canvas/常见效果.html" class="sidebar-link">常见效果</a></li></ul></section></li><li><a href="/css/" class="sidebar-link">css</a></li><li><section class="sidebar-group collapsable depth-0"><a href="/javascript/" class="sidebar-heading clickable"><span>javascript</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/react/" class="sidebar-heading clickable"><span>react</span> <span class="arrow right"></span></a> <!----></section></li><li><a href="/resume/" class="sidebar-link">resume</a></li><li><a href="/vue/" class="sidebar-link">vue</a></li><li><a href="/webpack/" aria-current="page" class="active sidebar-link">webpack</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/webpack/#基础概念" class="sidebar-link">基础概念</a></li><li class="sidebar-sub-header"><a href="/webpack/#过滤指定模块的插件" class="sidebar-link">过滤指定模块的插件</a></li></ul></li><li><section class="sidebar-group collapsable depth-0"><a href="/代码检查和风格/" class="sidebar-heading clickable"><span>代码检查和风格</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/包管理器/" class="sidebar-heading clickable"><span>包管理器</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/存档/" class="sidebar-heading clickable"><span>存档</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/打包工具/" class="sidebar-heading clickable"><span>打包工具</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/浏览器插件/" class="sidebar-heading clickable"><span>浏览器插件</span> <span class="arrow right"></span></a> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="webpack整理"><a href="#webpack整理" class="header-anchor">#</a> webpack整理</h1> <h2 id="基础概念"><a href="#基础概念" class="header-anchor">#</a> 基础概念</h2> <h2 id="过滤指定模块的插件"><a href="#过滤指定模块的插件" class="header-anchor">#</a> 过滤指定模块的插件</h2> <p>掘金地址：<a href="https://juejin.cn/post/7108255306609590286" target="_blank" rel="noopener noreferrer">https://juejin.cn/post/7108255306609590286<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> os <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'os'</span><span class="token punctuation">)</span>

  <span class="token comment">// 1、只需要在routes/pages添加需要构建的文件名称</span>
  <span class="token comment">// 2、过滤阶段，除了必须的模块，比如common，home</span>

  <span class="token keyword">class</span> <span class="token class-name">ineedCompileDirectoryPlugin</span> <span class="token punctuation">{</span>
      <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'webpack-lingke-ignore-plugin'</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>checkIgnore <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">checkIgnore</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>configPath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./ignore-plugin-config.json'</span><span class="token punctuation">)</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>config <span class="token operator">=</span> <span class="token keyword">null</span>
          <span class="token comment">// 过滤的模块</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>ignoreRoutes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>ignorePages <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
          <span class="token comment">// 过滤正则</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>ignores <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
          <span class="token comment">// 必须，不能被过滤的模块</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>requiredRoutes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'common'</span><span class="token punctuation">,</span> <span class="token string">'dev'</span><span class="token punctuation">,</span> <span class="token string">'systemManegement'</span><span class="token punctuation">]</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>requiredPages <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'dev'</span><span class="token punctuation">,</span> <span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token string">'layout'</span><span class="token punctuation">,</span> <span class="token string">'system'</span><span class="token punctuation">,</span> <span class="token string">'config'</span><span class="token punctuation">,</span> <span class="token string">'home'</span><span class="token punctuation">]</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>buildAll <span class="token operator">=</span> <span class="token boolean">false</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token function">isExistConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>configPath<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>config <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token keyword">let</span> <span class="token punctuation">{</span>
              buildRoutes<span class="token punctuation">,</span>
              buildPages<span class="token punctuation">,</span>
              buildAll
          <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>config
          <span class="token comment">// config中不管有没有配置，都要加上不能被过滤的模块，否则会影响整个系统项目构建</span>
          buildRoutes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span>buildRoutes<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>requiredRoutes<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
          buildPages <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span>buildPages<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>requiredPages<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;build Routes: &quot;</span><span class="token punctuation">,</span> buildRoutes<span class="token punctuation">)</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;build Pages: &quot;</span><span class="token punctuation">,</span> buildRoutes<span class="token punctuation">)</span>
          <span class="token keyword">const</span> routerPath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../src/router'</span><span class="token punctuation">)</span>
          <span class="token keyword">const</span> pagePath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../src/page'</span><span class="token punctuation">)</span>
          <span class="token keyword">const</span> allRoutes <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readdirSync</span><span class="token punctuation">(</span>routerPath<span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span>
          <span class="token keyword">const</span> allPages <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readdirSync</span><span class="token punctuation">(</span>pagePath<span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span>
          <span class="token keyword">const</span> routes <span class="token operator">=</span> allRoutes<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">r</span> <span class="token operator">=&gt;</span> <span class="token operator">!</span>buildRoutes<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> r<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
          <span class="token keyword">const</span> pages <span class="token operator">=</span> allPages<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">p</span> <span class="token operator">=&gt;</span> <span class="token operator">!</span>buildPages<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> p<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>ignoreRoutes <span class="token operator">=</span> routes
          <span class="token keyword">this</span><span class="token punctuation">.</span>ignorePages <span class="token operator">=</span> pages
          <span class="token keyword">this</span><span class="token punctuation">.</span>buildAll <span class="token operator">=</span> buildAll
          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">initIgnores</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token function">getConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">isExistConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'=== ignore-plugin初始化配置 ==='</span><span class="token punctuation">)</span>
              <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">initConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
              console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'=== ignore-plugin初始化成功，请配置后重新运行命令 ==='</span><span class="token punctuation">)</span>
              console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'=== 查看配置文件如下 ==='</span><span class="token punctuation">)</span>
              console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'=== '</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>configPath <span class="token operator">+</span> <span class="token string">' ==='</span><span class="token punctuation">)</span>
              process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
          <span class="token keyword">return</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>configPath<span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token function">setConfig</span><span class="token punctuation">(</span><span class="token parameter">routes<span class="token punctuation">,</span> pages</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">const</span> configJson <span class="token operator">=</span> <span class="token punctuation">{</span>
              <span class="token literal-property property">desc</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                  <span class="token string">&quot;1. buildAll: 构建全部&quot;</span><span class="token punctuation">,</span>
                  <span class="token string">&quot;2. routes: 需要构建的路由&quot;</span><span class="token punctuation">,</span>
                  <span class="token string">&quot;3. pages: 需要构建的页面&quot;</span><span class="token punctuation">,</span>
                  <span class="token string">&quot;4. remarks: 因为项目结构原因，不能清晰找出页面绑定的路由关系，所以只能通过page + route的方式控制构建&quot;</span>
              <span class="token punctuation">]</span><span class="token punctuation">,</span>
              <span class="token literal-property property">buildAll</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
              <span class="token literal-property property">buildRoutes</span><span class="token operator">:</span> routes<span class="token punctuation">,</span>
              <span class="token literal-property property">buildPages</span><span class="token operator">:</span> pages
          <span class="token punctuation">}</span>
          fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>configPath<span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>configJson<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token function">initConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">const</span> buildRoutes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>requiredRoutes<span class="token punctuation">]</span>
          <span class="token keyword">const</span> buildPages <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>requiredPages<span class="token punctuation">]</span>
          <span class="token comment">// 没有配置时</span>
          buildRoutes<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'customerCenter'</span><span class="token punctuation">)</span>
          buildPages<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'customerCenter'</span><span class="token punctuation">)</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setConfig</span><span class="token punctuation">(</span>buildRoutes<span class="token punctuation">,</span> buildPages<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token function">initIgnores</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">const</span> platform <span class="token operator">=</span> os<span class="token punctuation">.</span><span class="token function">platform</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token keyword">const</span> isMac <span class="token operator">=</span> platform <span class="token operator">===</span> <span class="token string">'darwin'</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;current platform: &quot;</span><span class="token punctuation">,</span> platform<span class="token punctuation">)</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>ignoreRoutes<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
              <span class="token keyword">let</span> regPath <span class="token operator">=</span> isMac <span class="token operator">?</span> <span class="token string">'src/router/'</span> <span class="token operator">:</span> <span class="token string">'src\\router\\'</span>
              <span class="token keyword">this</span><span class="token punctuation">.</span>ignores<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span>regPath <span class="token operator">+</span> e<span class="token punctuation">)</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>ignorePages<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
              <span class="token keyword">let</span> regPath <span class="token operator">=</span> isMac <span class="token operator">?</span> <span class="token string">'src/page/'</span> <span class="token operator">:</span> <span class="token string">'src\\page\\'</span>
              <span class="token keyword">this</span><span class="token punctuation">.</span>ignores<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span>regPath <span class="token operator">+</span> e<span class="token punctuation">)</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>

      <span class="token punctuation">}</span>
      <span class="token function">checkIgnore</span><span class="token punctuation">(</span><span class="token parameter">resolveData</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>resolveData<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token keyword">return</span> resolveData
          <span class="token punctuation">}</span>
          <span class="token keyword">let</span> <span class="token punctuation">{</span>
              context<span class="token punctuation">,</span>
              request
          <span class="token punctuation">}</span> <span class="token operator">=</span> resolveData
          <span class="token keyword">if</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'node_modules'</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">||</span> context<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'node_modules'</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token keyword">return</span> resolveData
          <span class="token punctuation">}</span>
          <span class="token keyword">let</span> absReq <span class="token operator">=</span> <span class="token string">''</span>
          <span class="token comment">// 相对路径，则直接拼接</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              absReq <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> request<span class="token punctuation">)</span>
          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'@'</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token comment">// 路径别名，则替换</span>
              absReq <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">'@'</span><span class="token punctuation">,</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../src'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
              <span class="token comment">// 说明它是第三方模块或者内置模块，比如require('fs'), require('core')</span>
              <span class="token comment">// 不需要理会</span>
              absReq <span class="token operator">=</span> <span class="token string">''</span>
          <span class="token punctuation">}</span>
          <span class="token keyword">try</span> <span class="token punctuation">{</span>
              <span class="token keyword">if</span> <span class="token punctuation">(</span>absReq<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                  <span class="token keyword">if</span> <span class="token punctuation">(</span>absReq<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'src/router'</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">||</span> absReq<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'src/page'</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                      <span class="token comment">// 如果在正则中匹配不到</span>
                      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>ignores<span class="token punctuation">.</span><span class="token function">some</span><span class="token punctuation">(</span><span class="token parameter">r</span> <span class="token operator">=&gt;</span> r<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>absReq<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                          <span class="token keyword">return</span> <span class="token boolean">false</span>
                      <span class="token punctuation">}</span>
                  <span class="token punctuation">}</span>
              <span class="token punctuation">}</span>
          <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'error: '</span><span class="token punctuation">)</span>
              console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span>
              console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span>
              console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>absReq<span class="token punctuation">)</span>
              console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
          <span class="token keyword">return</span> resolveData
      <span class="token punctuation">}</span>
      <span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter">compiler</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>buildAll<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token keyword">return</span>
          <span class="token punctuation">}</span>

          compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>normalModuleFactory<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">nmf</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
              nmf<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>beforeResolve<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>checkIgnore<span class="token punctuation">)</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
          compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>contextModuleFactory<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token parameter">cmf</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
              cmf<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>beforeResolve<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>checkIgnore<span class="token punctuation">)</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
          compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>done<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
              <span class="token comment">// 构建结束做些什么</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
      ineedCompileDirectoryPlugin
  <span class="token punctuation">}</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/vue/" class="prev">
        vue
      </a></span> <span class="next"><a href="/代码检查和风格/1-eslint.html">
        eslint
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.bb8cb600.js" defer></script><script src="/assets/js/11.a3791431.js" defer></script><script src="/assets/js/43.fafef18f.js" defer></script>
  </body>
</html>
