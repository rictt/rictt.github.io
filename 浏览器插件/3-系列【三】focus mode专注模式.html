<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>前言 | 狗子的博客</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/logo.png">
    <meta name="description" content="记录生活，记录bug!">
    
    <link rel="preload" href="/assets/css/0.styles.2d7509d5.css" as="style"><link rel="preload" href="/assets/js/app.bb8cb600.js" as="script"><link rel="preload" href="/assets/js/11.a3791431.js" as="script"><link rel="preload" href="/assets/js/60.4f7c43ab.js" as="script"><link rel="prefetch" href="/assets/js/1.22b784aa.js"><link rel="prefetch" href="/assets/js/12.6261f5b4.js"><link rel="prefetch" href="/assets/js/13.86a047ff.js"><link rel="prefetch" href="/assets/js/14.7953b57d.js"><link rel="prefetch" href="/assets/js/15.1ecae33c.js"><link rel="prefetch" href="/assets/js/16.c06b96a9.js"><link rel="prefetch" href="/assets/js/17.aea8c476.js"><link rel="prefetch" href="/assets/js/18.2ddb3342.js"><link rel="prefetch" href="/assets/js/19.46105c6c.js"><link rel="prefetch" href="/assets/js/2.7524170b.js"><link rel="prefetch" href="/assets/js/20.21d391f0.js"><link rel="prefetch" href="/assets/js/21.01f8e774.js"><link rel="prefetch" href="/assets/js/22.d82de8e2.js"><link rel="prefetch" href="/assets/js/23.c902bd4c.js"><link rel="prefetch" href="/assets/js/24.cb4ed996.js"><link rel="prefetch" href="/assets/js/25.06f23009.js"><link rel="prefetch" href="/assets/js/26.6a416950.js"><link rel="prefetch" href="/assets/js/27.f239f8b2.js"><link rel="prefetch" href="/assets/js/28.e6595db8.js"><link rel="prefetch" href="/assets/js/29.2499de18.js"><link rel="prefetch" href="/assets/js/3.c13987f3.js"><link rel="prefetch" href="/assets/js/30.ec2771a3.js"><link rel="prefetch" href="/assets/js/31.cab925d7.js"><link rel="prefetch" href="/assets/js/32.aaba9d6b.js"><link rel="prefetch" href="/assets/js/33.4dede3ae.js"><link rel="prefetch" href="/assets/js/34.e108cd73.js"><link rel="prefetch" href="/assets/js/35.31dd9db1.js"><link rel="prefetch" href="/assets/js/36.35a96604.js"><link rel="prefetch" href="/assets/js/37.ccd32209.js"><link rel="prefetch" href="/assets/js/38.767cc5f3.js"><link rel="prefetch" href="/assets/js/39.7ed8889b.js"><link rel="prefetch" href="/assets/js/4.7abd0e8e.js"><link rel="prefetch" href="/assets/js/40.d35c39ec.js"><link rel="prefetch" href="/assets/js/41.844b41da.js"><link rel="prefetch" href="/assets/js/42.f0c77d2b.js"><link rel="prefetch" href="/assets/js/43.fafef18f.js"><link rel="prefetch" href="/assets/js/44.3821eb8f.js"><link rel="prefetch" href="/assets/js/45.0585464f.js"><link rel="prefetch" href="/assets/js/46.1f77f027.js"><link rel="prefetch" href="/assets/js/47.f47808a4.js"><link rel="prefetch" href="/assets/js/48.dbaed69f.js"><link rel="prefetch" href="/assets/js/49.0859a6e0.js"><link rel="prefetch" href="/assets/js/5.dc5a5f90.js"><link rel="prefetch" href="/assets/js/50.cb3a8f5b.js"><link rel="prefetch" href="/assets/js/51.0b6551a0.js"><link rel="prefetch" href="/assets/js/52.ad422568.js"><link rel="prefetch" href="/assets/js/53.92cb68e0.js"><link rel="prefetch" href="/assets/js/54.f83681f3.js"><link rel="prefetch" href="/assets/js/55.0267d285.js"><link rel="prefetch" href="/assets/js/56.a82dbeec.js"><link rel="prefetch" href="/assets/js/57.ba4f8ea5.js"><link rel="prefetch" href="/assets/js/58.384dc386.js"><link rel="prefetch" href="/assets/js/59.04682dac.js"><link rel="prefetch" href="/assets/js/6.e5a57202.js"><link rel="prefetch" href="/assets/js/61.85cfacbf.js"><link rel="prefetch" href="/assets/js/62.cddefb27.js"><link rel="prefetch" href="/assets/js/63.867189ef.js"><link rel="prefetch" href="/assets/js/64.ab1ec420.js"><link rel="prefetch" href="/assets/js/65.35c96559.js"><link rel="prefetch" href="/assets/js/66.b256f951.js"><link rel="prefetch" href="/assets/js/67.ddb92cad.js"><link rel="prefetch" href="/assets/js/68.0860b2f0.js"><link rel="prefetch" href="/assets/js/69.58b713c5.js"><link rel="prefetch" href="/assets/js/7.d65eb7e3.js"><link rel="prefetch" href="/assets/js/70.001ed193.js"><link rel="prefetch" href="/assets/js/71.632935b7.js"><link rel="prefetch" href="/assets/js/72.ed6347bf.js"><link rel="prefetch" href="/assets/js/73.1ef8eae4.js"><link rel="prefetch" href="/assets/js/74.334f3694.js"><link rel="prefetch" href="/assets/js/75.b9dd2ad8.js"><link rel="prefetch" href="/assets/js/76.8bef6b4f.js"><link rel="prefetch" href="/assets/js/8.44a6ebd7.js"><link rel="prefetch" href="/assets/js/9.391e332d.js">
    <link rel="stylesheet" href="/assets/css/0.styles.2d7509d5.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.png" alt="狗子的博客" class="logo"> <span class="site-name can-hide">狗子的博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><a href="/canvas/" class="sidebar-heading clickable"><span>canvas</span> <span class="arrow right"></span></a> <!----></section></li><li><a href="/css/" class="sidebar-link">css</a></li><li><section class="sidebar-group collapsable depth-0"><a href="/javascript/" class="sidebar-heading clickable"><span>javascript</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/react/" class="sidebar-heading clickable"><span>react</span> <span class="arrow right"></span></a> <!----></section></li><li><a href="/resume/" class="sidebar-link">resume</a></li><li><a href="/vue/" class="sidebar-link">vue</a></li><li><a href="/webpack/" class="sidebar-link">webpack</a></li><li><section class="sidebar-group collapsable depth-0"><a href="/代码检查和风格/" class="sidebar-heading clickable"><span>代码检查和风格</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/包管理器/" class="sidebar-heading clickable"><span>包管理器</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/存档/" class="sidebar-heading clickable"><span>存档</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/打包工具/" class="sidebar-heading clickable"><span>打包工具</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/浏览器插件/" class="sidebar-heading clickable open"><span>浏览器插件</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/浏览器插件/1-系列【一】helloextension.html" class="sidebar-link">系列【一】helloextension</a></li><li><a href="/浏览器插件/2-系列【二】reading time计算阅读时间.html" class="sidebar-link">系列【二】readingtime计算阅读时间</a></li><li><a href="/浏览器插件/3-系列【三】focus mode专注模式.html" class="active sidebar-link">系列【三】focusmode专注模式</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/浏览器插件/3-系列【三】focus mode专注模式.html#前言" class="sidebar-link">前言</a></li><li class="sidebar-sub-header"><a href="/浏览器插件/3-系列【三】focus mode专注模式.html#_1、介绍" class="sidebar-link">1、介绍</a></li><li class="sidebar-sub-header"><a href="/浏览器插件/3-系列【三】focus mode专注模式.html#_2、新建我们的工作文件夹" class="sidebar-link">2、新建我们的工作文件夹</a></li><li class="sidebar-sub-header"><a href="/浏览器插件/3-系列【三】focus mode专注模式.html#_3、依次写入对应内容" class="sidebar-link">3、依次写入对应内容</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/浏览器插件/3-系列【三】focus mode专注模式.html#_3-1-manifest-json" class="sidebar-link">3.1 manifest.json</a></li><li class="sidebar-sub-header"><a href="/浏览器插件/3-系列【三】focus mode专注模式.html#_3-2-background-js后台运行脚本" class="sidebar-link">3.2 background.js后台运行脚本</a></li><li class="sidebar-sub-header"><a href="/浏览器插件/3-系列【三】focus mode专注模式.html#_3-3-设置知乎的专注模式" class="sidebar-link">3.3 设置知乎的专注模式</a></li></ul></li><li class="sidebar-sub-header"><a href="/浏览器插件/3-系列【三】focus mode专注模式.html#_4、总结" class="sidebar-link">4、总结</a></li><li class="sidebar-sub-header"><a href="/浏览器插件/3-系列【三】focus mode专注模式.html#相关链接" class="sidebar-link">相关链接</a></li></ul></li><li><a href="/浏览器插件/4-系列【四】调试我们开发的插件.html" class="sidebar-link">系列【四】调试我们开发的插件</a></li><li><a href="/浏览器插件/5-系列【五】tabs标签管理.html" class="sidebar-link">系列【五】tabs标签管理</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="前言"><a href="#前言" class="header-anchor">#</a> 前言</h2> <p>文章内容来源于Chrome开发者文档，大部分为翻译，加上自己的一点补充或者理解，不足之处请担待，系列将通过每个实战例子，来加深对插件开发的理解上手；</p> <p>目录导航</p> <ul><li><a href="https://juejin.cn/post/7159443319938875428" target="_blank" rel="noopener noreferrer">chrome浏览器开发系列(一)：hello extension<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://juejin.cn/post/7159443757878755364" target="_blank" rel="noopener noreferrer">chrome浏览器开发系列(二)：reading time计算阅读时间<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://juejin.cn/post/7159443901193928711" target="_blank" rel="noopener noreferrer">chrome浏览器开发系列(三)：focus mode专注模式<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://juejin.cn/post/7159444710384205832" target="_blank" rel="noopener noreferrer">chrome浏览器开发系列(四)：调试我们开发的插件<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://juejin.cn/post/7159445226707222558" target="_blank" rel="noopener noreferrer">chrome浏览器开发系列(五)：tabs标签管理<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h2 id="_1、介绍"><a href="#_1、介绍" class="header-anchor">#</a> 1、介绍</h2> <p>这一节开发的插件内容，除了基本的目录结构，还会对部分chrome api进行介绍；主要是通过开发一个针对知乎阅读的<code>专注模式</code>来进行熟悉，<code>所谓专注模式：</code>去除掉页面上的广告，多余不必要的信息，让用户能够纯粹进行阅读文章、评论；需求出来了，我们从技术的角度思考怎么做呢</p> <p><code>答案是：</code>用css样式隐藏掉广告元素，通过监听当前点击的tab是不是知乎，如果是，加入我们自定义的css样式文件，否则不做处理。</p> <h2 id="_2、新建我们的工作文件夹"><a href="#_2、新建我们的工作文件夹" class="header-anchor">#</a> 2、新建我们的工作文件夹</h2> <ul><li>新建<code>fouce-mode</code>文件夹</li></ul> <p><a href="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6ee26a1709954574a6b1d151913c326e~tplv-k3u1fbpfcp-watermark.image?" target="_blank" rel="noopener noreferrer">icon-16.png<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2837dbc93e544d67a68355ba3ddd7157~tplv-k3u1fbpfcp-watermark.image?" target="_blank" rel="noopener noreferrer">icon-32.png<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/828dcf7ef9004249aae1e7314817ae2f~tplv-k3u1fbpfcp-watermark.image?" target="_blank" rel="noopener noreferrer">icon-48.png<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6af66c941e5d45eab6652eb242504a10~tplv-k3u1fbpfcp-watermark.image?" target="_blank" rel="noopener noreferrer">icon-128.png<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <ul><li>下载下面的icon图片，<code>保存到images文件夹当中</code></li> <li>创建<code>manifest.json</code>清单文件</li> <li>创建<code>background.js</code>后台运行脚本文件</li> <li>创建<code>focus-mode.css</code>样式文件表</li></ul> <p>先创建好对应的文件结构后，下面我们依次往里面填代码，并说明对应的作用，下面是我们的项目结构，可以对比一下</p> <div class="language- extra-class"><pre class="language-text"><code>focus-mode
├── background.js
├── focus-mode.css
├── images
│   ├── icon-128.png
│   ├── icon-16.png
│   ├── icon-32.png
│   └── icon-48.png
└── manifest.json
</code></pre></div><h2 id="_3、依次写入对应内容"><a href="#_3、依次写入对应内容" class="header-anchor">#</a> 3、依次写入对应内容</h2> <h3 id="_3-1-manifest-json"><a href="#_3-1-manifest-json" class="header-anchor">#</a> 3.1 <code>manifest.json</code></h3> <p>细心的同学发现除了常见name，version，这次我们发现了新的面孔<code>background</code>和<code>permissions</code>；</p> <p>其中<code>background.service_worker</code>可以理解为插件程序运行时背后不断运行服务器/脚本，监听着chrome浏览器发生的变化，在脚本里面根据变化，做不同的东西，比如当鼠标切换tab栏，脚本对网页植入不同的脚本等等，下面我们会写。</p> <p><code>permissions</code>主要是向chrome声明，我这个插件需要什么权限，比如我要访问当前活跃（当前显示）的tab，那就需要在permission向chrome申请<code>activeTab</code>这个权限，当运行插件时，才能监听<code>activeTab</code>事件</p> <p>细心的同学可能发现了，<code>action设置的default_icon和icons是一样的，是不是多此一举呢？</code>，这里主要是为了能够能够使用<code>chrome.action</code>API，才设置的；官方文档说明了只有设置了action行为的icon，才会响应icon的点击事件，做不同的事情。</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;manifest_version&quot;</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Focus Mode&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Enable reading mode on Chrome's official Extensions and Chrome Web Store documentation.&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.0&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;icons&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;16&quot;</span><span class="token operator">:</span> <span class="token string">&quot;images/icon-16.png&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;32&quot;</span><span class="token operator">:</span> <span class="token string">&quot;images/icon-32.png&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;48&quot;</span><span class="token operator">:</span> <span class="token string">&quot;images/icon-48.png&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;128&quot;</span><span class="token operator">:</span> <span class="token string">&quot;images/icon-128.png&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;background&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;service_worker&quot;</span><span class="token operator">:</span> <span class="token string">&quot;background.js&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;action&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;default_icon&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;16&quot;</span><span class="token operator">:</span> <span class="token string">&quot;images/icon-16.png&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;32&quot;</span><span class="token operator">:</span> <span class="token string">&quot;images/icon-32.png&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;48&quot;</span><span class="token operator">:</span> <span class="token string">&quot;images/icon-48.png&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;128&quot;</span><span class="token operator">:</span> <span class="token string">&quot;images/icon-128.png&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 申请activeTab、scripting权限</span>
  <span class="token property">&quot;permissions&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;activeTab&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;scripting&quot;</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;commands&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 快捷键使用插件</span>
    <span class="token property">&quot;_execute_action&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;suggested_key&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;default&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Ctrl+U&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;mac&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Command+U&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_3-2-background-js后台运行脚本"><a href="#_3-2-background-js后台运行脚本" class="header-anchor">#</a> 3.2 <code>background.js</code>后台运行脚本</h3> <p>由于我们的background.js是有chrome注入到页面当中的，所以可以使用chrome中提供的api，如下面的<code>chrome.runtime.onInstalled</code>, <code>chrome.action.onClicked.addListener</code>等等；</p> <p><code>chrome.runtime.onInstalled</code>：当插件、浏览器发生安装时或者更新时执行的一个事件，我们在<code>background.js</code>中监听这个事件，当浏览器插件执行我们的事情：设置插件工具栏icon图标的副标题为&quot;OFF&quot;，如下</p> <p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/66e12564a46643bd9be32374f53c61ee~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p> <p><code>chrome.action.onClicked.addListener</code>：只有当前面我们设置了action下的default_icon，才会生效；当我们点击右上角工具栏的插件icon时，判断当前页面是否为知乎，设置副标题ON或者OFF，是的话开启/关闭专注模式；</p> <p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bdf6e8c10c8643d089e56881891c80c1~tplv-k3u1fbpfcp-watermark.image?" alt="QQ20221026-212723-HD.gif"></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token constant">STATE</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token constant">ON</span><span class="token operator">:</span> <span class="token string">&quot;ON&quot;</span><span class="token punctuation">,</span>
  <span class="token constant">OFF</span><span class="token operator">:</span> <span class="token string">&quot;OFF&quot;</span>
<span class="token punctuation">}</span>

chrome<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span>onInstalled<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  chrome<span class="token punctuation">.</span>action<span class="token punctuation">.</span><span class="token function">setBadgeText</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">text</span><span class="token operator">:</span> <span class="token constant">STATE</span><span class="token punctuation">.</span><span class="token constant">OFF</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

chrome<span class="token punctuation">.</span>action<span class="token punctuation">.</span>onClicked<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">tab</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 回调会返回一个tab，tab包含常见的id，index，url等</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>tab<span class="token punctuation">.</span>url<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'zhihu'</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 获取当前tab页的状态，是ON还是OFF</span>
    <span class="token keyword">const</span> prevState <span class="token operator">=</span> <span class="token keyword">await</span> chrome<span class="token punctuation">.</span>action<span class="token punctuation">.</span><span class="token function">getBadgeText</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">tabId</span><span class="token operator">:</span> tab<span class="token punctuation">.</span>id <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 如果当前为ON，则点击应该为OFF，关闭专注模式</span>
    <span class="token keyword">const</span> nextState <span class="token operator">=</span> prevState <span class="token operator">===</span> <span class="token constant">STATE</span><span class="token punctuation">.</span><span class="token constant">ON</span> <span class="token operator">?</span> <span class="token constant">STATE</span><span class="token punctuation">.</span><span class="token constant">OFF</span> <span class="token operator">:</span> <span class="token constant">STATE</span><span class="token punctuation">.</span><span class="token constant">ON</span>
    <span class="token comment">// 设置下标文本</span>
    <span class="token keyword">await</span> chrome<span class="token punctuation">.</span>action<span class="token punctuation">.</span><span class="token function">setBadgeText</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">tabId</span><span class="token operator">:</span> tab<span class="token punctuation">.</span>id<span class="token punctuation">,</span>
      <span class="token literal-property property">text</span><span class="token operator">:</span> nextState<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>nextState <span class="token operator">===</span> <span class="token constant">STATE</span><span class="token punctuation">.</span><span class="token constant">ON</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 插入我们自定义的css形成专注模式</span>
      <span class="token keyword">await</span> chrome<span class="token punctuation">.</span>scripting<span class="token punctuation">.</span><span class="token function">insertCSS</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">files</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;focus-mode.css&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token literal-property property">target</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">tabId</span><span class="token operator">:</span> tab<span class="token punctuation">.</span>id <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>nextState <span class="token operator">===</span> <span class="token constant">STATE</span><span class="token punctuation">.</span><span class="token constant">OFF</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 否则的话移除</span>
      <span class="token keyword">await</span> chrome<span class="token punctuation">.</span>scripting<span class="token punctuation">.</span><span class="token function">removeCSS</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">files</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;focus-mode.css&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token literal-property property">target</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">tabId</span><span class="token operator">:</span> tab<span class="token punctuation">.</span>id <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_3-3-设置知乎的专注模式"><a href="#_3-3-设置知乎的专注模式" class="header-anchor">#</a> 3.3 设置知乎的专注模式</h3> <p>所谓专注模式（粗糙版）：不影响阅读，去掉广告，专注于文字内容本身，所以我们首先分析页面上哪块区域是可以干掉屏蔽掉，针对性找到元素id或者class覆盖掉；如下</p> <p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d789379f83864d5090fbe00ced193813~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p> <p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/272a8263290e4eec9dee6306a6b7ec69~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p> <p>于是我们的css可以这样写，加important是为了让我们的样式最高级；平时开发不建议这样写</p> <div class="language-css extra-class"><pre class="language-css"><code><span class="token selector">.Question-sideColumn,
.AppHeader-inner</span> <span class="token punctuation">{</span>
  <span class="token property">display</span><span class="token punctuation">:</span> none <span class="token important">!important</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">.Question-mainColumn</span> <span class="token punctuation">{</span>
  <span class="token property">width</span><span class="token punctuation">:</span> auto <span class="token important">!important</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><p>效果就变成了如下</p> <p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e0917fdaffc64ff3b9ed7b411ffc981b~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p> <h2 id="_4、总结"><a href="#_4、总结" class="header-anchor">#</a> 4、总结</h2> <p>这期我们主要针对知乎做了一个专注模式，让我们更专心的摸鱼学习，不会被发现的太明显；主要逻辑都是在<code>background.js</code>里面，通过监听icon的点击事件，实时获取当前tab的url，判断是否知乎，注入我们的css，实现专注模式。</p> <h2 id="相关链接"><a href="#相关链接" class="header-anchor">#</a> 相关链接</h2> <ul><li><a href="https://github.com/rictt/chrome-extension/tree/master/focus-mode" target="_blank" rel="noopener noreferrer">源码地址<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://developer.chrome.com/docs/extensions/mv3/getstarted/tut-focus-mode/" target="_blank" rel="noopener noreferrer">原文地址<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://developer.chrome.com/docs/extensions/mv3/manifest/" target="_blank" rel="noopener noreferrer">v3 manifest清单配置<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://developer.chrome.com/docs/extensions/reference/tabs/#type-Tab" target="_blank" rel="noopener noreferrer">tab信息<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://developer.chrome.com/docs/extensions/reference/action/#badge" target="_blank" rel="noopener noreferrer">chrome.action<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://developer.chrome.com/docs/extensions/reference/runtime/" target="_blank" rel="noopener noreferrer">chrome.runtime<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://developer.chrome.com/docs/extensions/" target="_blank" rel="noopener noreferrer">插件文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://developer.chrome.com/docs/extensions/mv3/overview/" target="_blank" rel="noopener noreferrer">插件概念<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/浏览器插件/2-系列【二】reading time计算阅读时间.html" class="prev">
        系列【二】readingtime计算阅读时间
      </a></span> <span class="next"><a href="/浏览器插件/4-系列【四】调试我们开发的插件.html">
        系列【四】调试我们开发的插件
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.bb8cb600.js" defer></script><script src="/assets/js/11.a3791431.js" defer></script><script src="/assets/js/60.4f7c43ab.js" defer></script>
  </body>
</html>
